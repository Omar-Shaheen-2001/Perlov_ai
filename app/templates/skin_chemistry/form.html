{% extends "base.html" %}
{% block title %}ููููุงุก ุจุดุฑุชู ุงูุนุทุฑูุฉ{% endblock %}
{% block content %}
<div class="page-header text-center">
    <div class="container">
        <h1>Skin Chemistry Match</h1>
        <p class="opacity-75">ุงูุชุดู ุงูุนุทูุฑ ุงูุชู ุชุชูุงุนู ุจุดูู ูุซุงูู ูุน ุจุดุฑุชู</p>
    </div>
</div>
<div class="container py-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card shadow-sm rounded-4 border-0" style="background: rgba(255, 255, 255, 0.95);">
                <div class="card-body p-4">
                    <div id="inputs-section">
                        <h2 class="fw-bold mb-4 text-center">ุชุญููู ุฏููู ูููููุงุก ุจุดุฑุชู</h2>
                        <form id="analysis-form">
                            <!-- ุงูุตู ุงูุฃูู -->
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <label class="form-label fw-bold"><i class="bi bi-droplet me-2"></i>ููุน ุงูุจุดุฑุฉ</label>
                                    <select class="form-select form-select-lg rounded-3" id="skin_type" required>
                                        <option value="">ุงุฎุชุฑ ููุน ุจุดุฑุชู</option>
                                        <option value="ุฌุงูุฉ">ุฌุงูุฉ</option>
                                        <option value="ุฏูููุฉ">ุฏูููุฉ</option>
                                        <option value="ูุฎุชูุทุฉ">ูุฎุชูุทุฉ</option>
                                        <option value="ุนุงุฏูุฉ">ุนุงุฏูุฉ</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <label class="form-label fw-bold"><i class="bi bi-shield me-2"></i>ุญุณุงุณูุฉ ุงูุจุดุฑุฉ</label>
                                    <select class="form-select form-select-lg rounded-3" id="sensitivity" required>
                                        <option value="">ุงุฎุชุฑ ูุณุชูู ุงูุญุณุงุณูุฉ</option>
                                        <option value="ุญุณุงุณุฉ ุฌุฏุงู">ุญุณุงุณุฉ ุฌุฏุงู</option>
                                        <option value="ุญุณุงุณุฉ">ุญุณุงุณุฉ</option>
                                        <option value="ูุชูุณุทุฉ">ูุชูุณุทุฉ</option>
                                        <option value="ุบูุฑ ุญุณุงุณุฉ">ุบูุฑ ุญุณุงุณุฉ</option>
                                    </select>
                                </div>
                            </div>

                            <!-- ุญุฑุงุฑุฉ ุงูุฌุณู ูุงูููุงุทู ุงูุฏูููุฉ -->
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <label class="form-label fw-bold"><i class="bi bi-thermometer me-2"></i>ุญุฑุงุฑุฉ ุงูุฌุณู</label>
                                    <select class="form-select form-select-lg rounded-3" id="body_temp">
                                        <option value="ุจุงุฑุฏุฉ">ุจุงุฑุฏุฉ</option>
                                        <option value="ูุนุชุฏูุฉ" selected>ูุนุชุฏูุฉ</option>
                                        <option value="ุฏุงูุฆุฉ">ุฏุงูุฆุฉ</option>
                                        <option value="ุญุงุฑุฉ">ุญุงุฑุฉ</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <label class="form-label fw-bold"><i class="bi bi-circle-half me-2"></i>ุงูููุงุทู ุงูุฏูููุฉ</label>
                                    <select class="form-select form-select-lg rounded-3" id="oily_areas">
                                        <option value="">ูุง ุชูุฌุฏ ููุงุทู ุฏูููุฉ</option>
                                        <option value="ุงูุฌุจูู">ุงูุฌุจูู ููุท</option>
                                        <option value="ุงูุฌุจูู ูุงูุฃูู">ุงูุฌุจูู ูุงูุฃูู (T-Zone)</option>
                                        <option value="ุงููุฌู ููู">ุงููุฌู ููู</option>
                                    </select>
                                </div>
                            </div>

                            <!-- ุงูููุงุทู ุงูุฌุงูุฉ ูุงูุชูุงุนูุงุช -->
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <label class="form-label fw-bold"><i class="bi bi-square me-2"></i>ุงูููุงุทู ุงูุฌุงูุฉ</label>
                                    <select class="form-select form-select-lg rounded-3" id="dry_areas">
                                        <option value="">ูุง ุชูุฌุฏ ููุงุทู ุฌุงูุฉ</option>
                                        <option value="ุงูุฎุฏูู">ุงูุฎุฏูู</option>
                                        <option value="ููุทูุฉ ุงูุนููู">ููุทูุฉ ุงูุนููู</option>
                                        <option value="ููุงุทู ูุชุนุฏุฏุฉ">ููุงุทู ูุชุนุฏุฏุฉ</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <label class="form-label fw-bold"><i class="bi bi-exclamation-circle me-2"></i>ุชูุงุนูุงุช ุณุงุจูุฉ</label>
                                    <input type="text" class="form-control rounded-3 form-control-lg" id="reactions" placeholder="ูุซุงู: ุญูุฉุ ุงุญูุฑุงุฑุ ุชููุฌ">
                                </div>
                            </div>

                            <!-- ุงูุนุทูุฑ ุงูุณุงุจูุฉ ูุงูุชูุถููุงุช -->
                            <div class="mb-4">
                                <label class="form-label fw-bold"><i class="bi bi-x-circle me-2"></i>ุนุทูุฑ ูู ุชุซุจุช ุณุงุจูุงู ุฃู ุณุจุจุช ูุดุงูู</label>
                                <textarea class="form-control rounded-3" id="failed_perfumes" rows="2" placeholder="ูุซุงู: Chanel No.5 (ูู ุชุฏู ุทูููุงู)ุ Dior J'adore (ุณุจุจ ุญูุฉ)"></textarea>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-bold"><i class="bi bi-heart me-2"></i>ุชูุถููุงุช ุงูุนุทูุฑ ุงูููุถูุฉ</label>
                                <textarea class="form-control rounded-3" id="preferences" rows="2" placeholder="ูุซุงู: ุนุทูุฑ ุดุฑููุฉุ ุฎุดุจูุฉุ ุฒูุฑูุฉ ูุงุชุญุฉ"></textarea>
                            </div>

                            <div class="text-center">
                                <button type="button" class="btn btn-gradient btn-lg rounded-pill px-5" id="analyze-btn">
                                    <i class="bi bi-flask me-2"></i>ุชุญููู ููููุงุก ุงูุจุดุฑุฉ
                                </button>
                            </div>
                        </form>
                    </div>
                    <div id="results-section" class="d-none">
                        <h2 class="fw-bold mb-4 text-center">ูุชุงุฆุฌ ุงูุชุญููู ุงูุฏููู ูููููุงุก ุจุดุฑุชู</h2>

                        <!-- ุงูุนุทูุฑ ุงูููุงุณุจุฉ ููููุงุฆูุงู -->
                        <div class="mb-4">
                            <div class="card rounded-4 border-0" style="background: linear-gradient(135deg, rgba(79, 125, 255, 0.15) 0%, rgba(242, 244, 248, 0.2) 100%);">
                                <div class="card-body">
                                    <h5 class="fw-bold mb-3"><i class="bi bi-check-circle-fill text-primary me-2"></i>ุงูุนุทูุฑ ุงูููุงุณุจุฉ ููููุงุฆูุงู</h5>
                                    <div id="suitable-perfumes" style="max-height: 600px; overflow-y: auto;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ุชุญููู ุงูุซุจุงุช -->
                        <div class="mb-4">
                            <div class="card rounded-4 border-0" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(255, 235, 130, 0.15) 100%);">
                                <div class="card-body">
                                    <h5 class="fw-bold mb-3"><i class="bi bi-hourglass-split text-warning me-2"></i>ุชุญููู ุงูุซุจุงุช ุงููุชููุน</h5>
                                    <div id="stability-analysis"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ุงูุงุนุชุจุงุฑุงุช ุงูููููุงุฆูุฉ -->
                        <div class="mb-4">
                            <div class="card rounded-4 border-0" style="background: linear-gradient(135deg, rgba(220, 53, 69, 0.15) 0%, rgba(255, 193, 193, 0.15) 100%);">
                                <div class="card-body">
                                    <h5 class="fw-bold mb-3"><i class="bi bi-flask text-danger me-2"></i>ุงูุงุนุชุจุงุฑุงุช ุงูููููุงุฆูุฉ</h5>
                                    
                                    <div class="mb-3">
                                        <h6 class="fw-bold text-success mb-2">โ ุงูููููุงุช ุงูุขููุฉ:</h6>
                                        <div id="safe-ingredients" class="ms-2"></div>
                                    </div>

                                    <div class="mb-3">
                                        <h6 class="fw-bold text-danger mb-2">โ ุงูููููุงุช ุงููุฑุงุฏ ุชุฌูุจูุง:</h6>
                                        <div id="avoid-ingredients" class="ms-2"></div>
                                    </div>

                                    <div>
                                        <h6 class="fw-bold text-muted mb-2">๐ ุงูุฃุณุจุงุจ ุงูุนูููุฉ:</h6>
                                        <div id="why-avoid" class="ms-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ุงูุชูุตูุงุช ุงูุชูุตูููุฉ -->
                        <div class="mb-4">
                            <div class="card rounded-4 border-0" style="background: linear-gradient(135deg, rgba(52, 211, 153, 0.15) 0%, rgba(167, 243, 208, 0.15) 100%);">
                                <div class="card-body">
                                    <h5 class="fw-bold mb-3"><i class="bi bi-lightbulb-fill text-success me-2"></i>ุงูุชูุตูุงุช ุงูุชูุตูููุฉ</h5>
                                    <div id="detailed-recommendations"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ุชูุงูู ุงูุนูุงูุฉ ุจุงูุจุดุฑุฉ -->
                        <div class="mb-4">
                            <div class="card rounded-4 border-0" style="background: linear-gradient(135deg, rgba(103, 58, 183, 0.15) 0%, rgba(186, 104, 200, 0.15) 100%);">
                                <div class="card-body">
                                    <h5 class="fw-bold mb-3"><i class="bi bi-heart-fill text-info me-2"></i>ุชูุงูู ุงูุนูุงูุฉ ุจุงูุจุดุฑุฉ</h5>
                                    <p id="skincare-compatibility" class="mb-0"></p>
                                </div>
                            </div>
                        </div>

                        <!-- ูุตุงุฆุญ ุงูุชุทุจูู -->
                        <div class="mb-4">
                            <div class="card rounded-4 border-0" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(165, 214, 167, 0.15) 100%);">
                                <div class="card-body">
                                    <h5 class="fw-bold mb-3"><i class="bi bi-bookmark-check text-success me-2"></i>ูุตุงุฆุญ ุงูุชุทุจูู ุงูุฃูุซู</h5>
                                    <p id="application-tips" class="mb-0"></p>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button type="button" class="btn btn-outline-primary btn-lg rounded-pill px-5" id="back-btn">
                                <i class="bi bi-arrow-right me-2"></i>ุฅุนุงุฏุฉ ุงูุชุญููู
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
document.getElementById('analyze-btn').addEventListener('click', function() {
    const btn = this;
    const data = {
        skin_type: document.getElementById('skin_type').value,
        sensitivity: document.getElementById('sensitivity').value,
        body_temp: document.getElementById('body_temp').value,
        oily_areas: document.getElementById('oily_areas').value,
        dry_areas: document.getElementById('dry_areas').value,
        reactions: document.getElementById('reactions').value,
        failed_perfumes: document.getElementById('failed_perfumes').value,
        preferences: document.getElementById('preferences').value
    };
    
    if (!data.skin_type || !data.sensitivity) {
        showError('ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ');
        return;
    }
    
    showLoading(btn);
    fetch('{{ url_for("skin_chemistry.analyze") }}', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(r => r.json())
    .then(result => {
        hideLoading(btn);
        const analysis = result.analysis;
        
        // Display suitable perfumes with detailed info
        if (analysis.suitable_perfumes && analysis.suitable_perfumes.length > 0) {
            const perfumesHtml = analysis.suitable_perfumes.map((p, idx) => `
                <div class="card rounded-3 border-0 mb-3" style="background: linear-gradient(135deg, rgba(11, 46, 138, 0.05) 0%, rgba(242, 244, 248, 0.1) 100%);">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <h6 class="fw-bold mb-1">${idx + 1}. ${p.name || 'ุนุทุฑ'}</h6>
                                <p class="text-muted mb-0" style="font-size: 0.9rem;">${p.brand || ''}</p>
                            </div>
                            <span class="badge bg-primary rounded-pill" style="background: linear-gradient(135deg, #0B2E8A 0%, #4F7DFF 100%) !important;">${p.compatibility || 0}%</span>
                        </div>
                        <p class="mb-2" style="font-size: 0.95rem;"><strong>ุงูุนุงุฆูุฉ:</strong> ${p.family || ''}</p>
                        <p class="mb-2" style="font-size: 0.95rem;"><i class="bi bi-info-circle text-primary me-1"></i><strong>ุงูุณุจุจ ุงูุนููู:</strong> ${p.chemistry_reason || ''}</p>
                        <p class="mb-0" style="font-size: 0.9rem;"><i class="bi bi-hourglass-split text-warning me-1"></i><strong>ุงูุซุจุงุช:</strong> ${p.longevity_hours || 0} ุณุงุนุงุช</p>
                    </div>
                </div>
            `).join('');
            document.getElementById('suitable-perfumes').innerHTML = perfumesHtml;
        }
        
        // Display stability analysis
        if (analysis.stability_analysis) {
            const stability = analysis.stability_analysis;
            const stabilityHtml = `
                <div class="mb-3">
                    <p class="mb-2"><strong>ูุณุชูู ุงูุซุจุงุช:</strong> <span class="badge bg-warning">${stability.level || 'ุบูุฑ ูุญุฏุฏ'}</span></p>
                    <p class="mb-2"><strong>ุงููุฏุฉ ุงููุชููุนุฉ:</strong> ${stability.estimated_hours || 0} ุณุงุนุงุช</p>
                    <p class="mb-2"><strong>ุชุฃุซูุฑ ุญุฑุงุฑุฉ ุงูุฌุณู:</strong> ${stability.body_heat_effect || 'ูุชูุงุฒู'}</p>
                    <p class="mb-0"><strong>ุชุฃุซูุฑ ููุน ุงูุจุดุฑุฉ:</strong> ${stability.skin_chemistry_effect || 'ุฅูุฌุงุจู'}</p>
                </div>
            `;
            document.getElementById('stability-analysis').innerHTML = stabilityHtml;
        }
        
        // Display chemical considerations
        if (analysis.chemical_considerations) {
            const chem = analysis.chemical_considerations;
            
            // Safe ingredients
            const safeHtml = (chem.safe_ingredients || []).map(i => 
                `<div class="mb-1"><i class="bi bi-check-circle text-success me-2"></i>${i}</div>`
            ).join('') || '<p class="text-muted">ูู ุชุญุฏุฏ</p>';
            document.getElementById('safe-ingredients').innerHTML = safeHtml;
            
            // Avoid ingredients
            const avoidHtml = (chem.avoid_ingredients || []).map(i => 
                `<div class="mb-1"><span class="badge bg-danger me-2">${i}</span></div>`
            ).join('') || '<p class="text-muted">ูู ุชุญุฏุฏ</p>';
            document.getElementById('avoid-ingredients').innerHTML = avoidHtml;
            
            // Why avoid
            const whyHtml = (chem.why_avoid || []).map(r => 
                `<div class="mb-1"><i class="bi bi-exclamation-triangle text-warning me-2"></i>${r}</div>`
            ).join('') || '<p class="text-muted">ูู ุชุญุฏุฏ</p>';
            document.getElementById('why-avoid').innerHTML = whyHtml;
        }
        
        // Display detailed recommendations
        if (analysis.detailed_recommendations && Array.isArray(analysis.detailed_recommendations)) {
            const recsHtml = analysis.detailed_recommendations.map(r => 
                `<div class="mb-2"><i class="bi bi-lightbulb text-warning me-2"></i>${r}</div>`
            ).join('');
            document.getElementById('detailed-recommendations').innerHTML = recsHtml;
        }
        
        // Display skincare compatibility
        if (analysis.skincare_compatibility) {
            document.getElementById('skincare-compatibility').innerHTML = `<i class="bi bi-heart text-info me-2"></i>${analysis.skincare_compatibility}`;
        }
        
        // Display application tips
        if (analysis.application_tips) {
            document.getElementById('application-tips').innerHTML = `<i class="bi bi-bookmark-check text-success me-2"></i>${analysis.application_tips}`;
        }
        
        document.getElementById('inputs-section').classList.add('d-none');
        document.getElementById('results-section').classList.remove('d-none');
        showSuccess('ุชู ุชุญููู ููููุงุก ุจุดุฑุชู ุจูุฌุงุญ!');
    })
    .catch(err => {
        hideLoading(btn);
        showError('ุญุฏุซ ุฎุทุฃุ ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู');
    });
});

document.getElementById('back-btn').addEventListener('click', function() {
    document.getElementById('results-section').classList.add('d-none');
    document.getElementById('inputs-section').classList.remove('d-none');
    document.getElementById('analysis-form').reset();
});
</script>
{% endblock %}
